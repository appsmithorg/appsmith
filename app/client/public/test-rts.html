<!DOCTYPE html>
<html>
  <head>
    <title>Socket.IO chat</title>
    <style>
      body { margin: 0; padding-bottom: 3rem; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
    </style>
  </head>

  <body>
    <label>Join an application</label>
    <form id="loginform" action="">
        Application Id: <input id="appIdInput" name="appid" autocomplete="off" required />
        <button type="button" id="editAppBtn">Edit App</button>
        <button type="button" id="leaveAppBtn">Leave App</button>
    </form>
    
    <label>Current app users: </label>
    <ul id="onlineUsers"></ul>

    <script src="https://cdn.socket.io/4.1.2/socket.io.min.js" integrity="sha384-toS6mmwu70G0fw54EGlWWeA4z3dyJ+dlXBtSURSKN4vyRFOcxd3Bzjj/AoOwY+Rg" crossorigin="anonymous"></script>
    <script>
        var socket = io();
        var onlineUsers = document.getElementById('onlineUsers');
        var leaveAppBtn = document.getElementById('leaveAppBtn');
        var editAppBtn = document.getElementById('editAppBtn');
        var appIdInput = document.getElementById('appIdInput');

        socket.on('collab:online_app_editors', function(eventData) {
            console.log(eventData);
            onlineUsers.innerHTML = ''; // clear the list first
            eventData.users.forEach(user => {
                var item = document.createElement('li');
                item.textContent = `${user.name} (${user.email})`;
                onlineUsers.appendChild(item);
            });
        });

        editAppBtn.onclick = function() {
            socket.emit('collab:start_edit_app', appIdInput.value);
        };

        leaveAppBtn.onclick = function() {
            socket.emit('collab:leave_edit_app', appIdInput.value);
        };
      </script>
  </body>
</html>