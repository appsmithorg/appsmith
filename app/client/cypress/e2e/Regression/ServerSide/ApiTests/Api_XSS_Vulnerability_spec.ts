import { apiPage, agHelper } from "../../../../support/Objects/ObjectsCore";

describe("Ensure XSS vulnerability are handled", () => {
  const test_rest_api_url1 = "https://jsonplaceholder.typicode.com/users";

  it("1. Ensures xss scripts are not executed when an API is run.", () => {
    apiPage.CreateApi("FirstAPI");
    apiPage.EnterURL(test_rest_api_url1);
    apiPage.EnterHeader(
      `<img src=x onerror='fetch("/api/v1/admin/env").then(r=>r.text()).then(body=>document.body.insertAdjacentHTML("beforeend", "<h1 class=\"xss-container\" style=\"color:red;font-size:72px;position:absolute;top:0;z-index:9\">Poof!</h1>"))'>`,
      "value",
    );
    apiPage.RunAPI();
    agHelper.AssertElementAbsence(".xss-container");
  });

  it("2. Ensures that html tags are removed and only the enclosed text is left.", () => {
    apiPage.CreateApi("SecondAPI");
    apiPage.EnterURL(test_rest_api_url1);
    apiPage.EnterHeader(
      `<img src=x onerror="&#0000106&#0000097&#0000118&#0000097&#0000115&#0000099&#0000114&#0000105&#0000112&#0000116&#0000058&#0000097&#0000108&#0000101&#0000114&#0000116&#0000040&#0000039&#0000088&#0000083&#0000083&#0000039&#0000041">`,
      "world",
    );
    agHelper.RefreshPage();
    apiPage.ValidateHeaderParams({ key: `<img src="x">`, value: "world" });
  });
});
