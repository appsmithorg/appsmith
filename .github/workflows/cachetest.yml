name: gitcachetest

on:
  # This line enables manual triggering of this workflow.
  workflow_dispatch:

jobs:
  ci-test-limited:
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash
    strategy:
      fail-fast: false


    steps:
      - name: Set up Depot CLI
        uses: depot/setup-action@v1

      # Checkout the code in the current branch in case the workflow is called because of a branch push event
      - name: Checkout the head commit of the branch
        if: inputs.pr == 0
        uses: actions/checkout@v3
        with:
          fetch-depth: 0
       # Create cache dir
      - name: Create cache dir
        if: steps.run_result.outputs.run_result != 'success' && steps.run_result.outputs.run_result != 'failedtest'
        run: |
          mkdir ./cacherepo
           git config --global user.email "yatin@appsmith.com"
           git config --global user.name "Yatinappsmith"

      - name: Checkout
        uses: actions/checkout@v2
        with:
          repository: yatinappsmith/testcacherepo
          path: './cacherepo'

      #- name: Setup upterm session
      #  uses: lhotari/action-upterm@v1

      - name: Addfile
        if: steps.run_result.outputs.run_result != 'success' && steps.run_result.outputs.run_result != 'failedtest'
        env:
          cachetoken: ${{ secrets.CACHETOKEN }}
          
        run: |
          cd ./cacherepo
          git clone https://$cachetoken@github.com/yatinappsmith/testcacherepo.git
          cd testcacherepo
          tr -dc A-Za-z0-9 </dev/urandom | head -c 13 > bcdefghtxt
          git add bcdefghtxt
          git commit -m "test12321321"
          git push
          
      
