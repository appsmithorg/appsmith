name: TestCache

on:
  # This line enables manual triggering of this workflow.
  workflow_dispatch:
  
jobs:
  Testcache:
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash

    steps:
      # Checkout the code
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0

      # Checkout the code
      - name: Restore the previous run result
        id: cache-appsmith
        uses: martijnhols/actions-cache@v3
        with:
          path: |
            ~/run_result
          key: ${{ github.run_id }}-${{ github.job }}-${{ matrix.job }}
          
            
      - name: Get the previous run result
        if: steps.cache-appsmith.outputs.cache-hit == 'true'
        id: run_result
        run: |
          run_result_env=$(cat ~/run_result)
          echo "run_result=$run_result_env" >> $GITHUB_OUTPUT
        
      - name: Check previous run result
        env:
          STEPS_CONTEXT: ${{ steps.run_result.outputs.run_result }}
        run: echo "$STEPS_CONTEXT"
        
      - name: Dump steps context
        env:
          STEPS_CONTEXT: ${{ toJson(steps) }}
        run: echo "$STEPS_CONTEXT"
               
      - name: check status of previous run
        if: steps.run_result.outputs.run_result_env == 'failedtest'
        run: echo "hello World"
 
       # Set status = success
      - run: echo "failedtest" > ~/run_result
 
      - name: Store the previous run result
        uses: martijnhols/actions-cache/save@v3
        with:
          path: |
            ~/run_result
          key: ${{ github.run_id }}-${{ github.job }}-${{ matrix.job }}
          restore-keys: |
            ${{ github.run_id }}-${{ github.job }}-${{ matrix.job }}  
