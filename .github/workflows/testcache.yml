name: TestCache

on:
  # This line enables manual triggering of this workflow.
  workflow_dispatch:
  
jobs:
  Testcache:
    runs-on: ubuntu-latest
    defaults:
      run:
        shell: bash

    steps:
      # Checkout the code
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0

      # Checkout the code
      - name: Restore the previous run result
        uses: martijnhols/actions-cache@v3
        with:
          path: |
            ~/run_result
          key: ${{ github.run_id }}-${{ github.job }}-${{ matrix.job }}

            
      - name: Get the previous run result
        id: run_result
        run: cat ~/run_result 2>/dev/null || echo 'default'
        
      - name: Check previous run result
        id: check_run_result
        run: echo {{ $steps.run_result.outputs.run_result }}
        
      - name: check status of previous run
        if: steps.run_result.outputs.run_result == 'failedtest'
        run: echo "hello World"
 
       # Set status = success
      - run: echo "failedtest" > ~/run_result
 
      - name: Store the previous run result
        uses: martijnhols/actions-cache/save@v3
        with:
          path: |
            ~/run_result
          key: ${{ github.run_id }}-${{ github.job }}-${{ matrix.job }}
          restore-keys: |
            ${{ github.run_id }}-${{ github.job }}-${{ matrix.job }}  
