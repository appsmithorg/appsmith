# This buildspec will build and publish Docker images.
# It does NOT run any tests.

version: 0.2

env:
  shell: bash

phases:

  build:
    on-failure: ABORT
    commands:
      - mkdir -pv ci/logs
      - source ci/3-scripts/3-build.sh >> "ci/logs/$CODEBUILD_BATCH_BUILD_IDENTIFIER.log" 2>&1
    finally:
      - source ci/upload-logs.sh

  post_build:
    commands:
      - mkdir -pv ci/logs
      - source ci/cleanup.sh >> "ci/logs/$CODEBUILD_BATCH_BUILD_IDENTIFIER.log" 2>&1
    finally:
      - UPLOAD_LOGS_ON_SUCCESS=1
      - source ci/upload-logs.sh
