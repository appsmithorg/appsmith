version: 0.2

env:
  shell: bash

phases:
  install:
    runtime-versions:
      java: corretto11
      nodejs: 14

batch:
  fail-fast: false

  build-graph:

    # Run unit tests on client and server.
    - identifier: units
      buildspec: ci/1-units.yml
      env:
        compute-type: BUILD_GENERAL1_MEDIUM
      debug-session: true

    # # Run all Cypress tests.
    # - identifier: cypress1
    #   buildspec: ci/2-cypress.yml
    #   env:
    #     compute-type: BUILD_GENERAL1_MEDIUM
    #   debug-session: true

    # Publish
    - identifier: publish
      buildspec: ci/3-publish.yml
      env:
        compute-type: BUILD_GENERAL1_MEDIUM
      debug-session: true
      depend-on:
        - units
        # - cypress1
